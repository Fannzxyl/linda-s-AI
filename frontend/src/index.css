/* C:\Alfan\linda-s-AI\frontend\src\index.css */

/* ====== THEME TOKENS ====== */
:root{
  color-scheme: dark;
  --bg:#0b1020;
  --panel:#0f1424cc;
  --panel-strong:#0f1424e6;
  --text:#e9edf5;
  --muted:#9aa4b2;
  --primary:#6ea8ff;
  --accent:#a855f7;
  --ring: rgba(110,168,255,.28);
  --radius:18px;
  --gap1:8px; --gap2:12px; --gap3:16px; --gap4:24px; --gap5:32px;
  --shadow:0 18px 60px rgba(4,10,30,.55);
  --safe-top:env(safe-area-inset-top,0px);
  --safe-bottom:env(safe-area-inset-bottom,0px);
}

/* Persona */
body[data-persona="ceria"]{ --primary:#ffb86b; --accent:#ffd166; --ring: rgba(255,184,107,.28) }
body[data-persona="santai"]{ --primary:#34d399; --accent:#22c55e; --ring: rgba(52,211,153,.28) }
body[data-persona="formal"]{ --primary:#60a5fa; --accent:#3b82f6; --ring: rgba(96,165,250,.28) }
body[data-persona="tsundere"]{ --primary:#f472b6; --accent:#fb7185; --ring: rgba(244,114,182,.28) }
body[data-persona="yandere"]{ --primary:#ec4899; --accent:#e11d48; --ring: rgba(236,72,153,.28) }
body[data-persona="netral"]{ --primary:#6ea8ff; --accent:#a855f7; --ring: rgba(110,168,255,.28) }

/* ====== RESET ====== */
*{ box-sizing:border-box }
html,body,#root{ height:100% }
html{ font-size:100% }
body{
  margin:0;
  background:
    radial-gradient(1200px 800px at 10% -10%, #12203a 0%, transparent 40%),
    radial-gradient(1000px 700px at 110% 10%, #1e293b 0%, transparent 35%),
    var(--bg);
  color:var(--text);
  font-family: Inter, "Segoe UI", system-ui, -apple-system, sans-serif;
  -webkit-font-smoothing: antialiased;
  -webkit-tap-highlight-color: transparent;
}

/* ====== APP SHELL ====== */
.app{
  min-height:100svh;
  display:grid;
  grid-template-rows: auto 1fr auto;
}

.app-header{
  position:sticky; top:0; z-index:3;
  display:flex; align-items:center; justify-content:center;
  height:56px;
  padding:calc(var(--gap2) + var(--safe-top)) var(--gap4) var(--gap2);
  background: linear-gradient(180deg, rgba(10,12,22,.65), rgba(10,12,22,0));
  backdrop-filter: blur(10px);
}

.brand{
  display:flex; align-items:center; gap:.6rem;
  font-weight:700; letter-spacing:.3px;
  color:#f6f7fb;
}
.brand-dot{
  width:10px; height:10px; border-radius:999px; background:var(--primary);
  box-shadow:0 0 0 6px var(--ring);
}

/* ====== CONTENT GRID ====== */
.layout{
  width:min(1200px, 96vw);
  margin-inline:auto;
  display:grid;
  grid-template-columns: 340px 1fr;
  gap: var(--gap4);
  padding: var(--gap4);
}

/* Sidebar */
.sidebar{
  background: var(--panel-strong);
  border:1px solid rgba(148,163,184,.18);
  border-radius: 20px;
  padding: 16px;
  box-shadow: var(--shadow);
  display:flex; flex-direction:column; gap:16px;
}

.section-title{
  margin:0; font-size: 1.05rem; font-weight:700; color:#f7f9ff;
}

/* Avatar card container di sidebar */
.avatar-card{
  border-radius: 16px;
  overflow:hidden;
  background: radial-gradient(120% 120% at 15% 15%, #1a2742, #0e1530 60%);
  border:1px solid rgba(148,163,184,.14);
  position:relative;
  /* RASIO: 1:1 sesuai gambar */
  aspect-ratio: 1/1; 
  display:grid; place-items:center;
}
.avatar-glow{
  position:absolute; inset:16% 22%; filter:blur(30px);
  background: radial-gradient(circle, color-mix(in oklab, var(--primary), #ffffff 20%) 30%, transparent 70%);
  opacity:.65;
  transition: opacity .4s ease-out; /* Transisi untuk glow */
}
/* Menurunkan opasitas glow saat Avatar tidak typing */
.avatar-card:not(:has(.avatar-speaking)){ 
  .avatar-glow { opacity: .35; }
}

.avatar-canvas{ position:relative; z-index:2 }

/* Controls */
.control{
  background: var(--panel);
  border:1px solid rgba(148,163,184,.18);
  border-radius: 14px;
  padding: 12px;
  display:flex; flex-direction:column; gap:10px;
}
.label{ font-size:.9rem; color:#cbd5f5 }
.select, .checkbox{
  /* GANTI BACKGROUND KE SOLID DAN TAMBAH COLOR-SCHEME UNTUK FIX DROPDOWN */
  background: #0f172a; 
  color: #e2e8f0;
  border-radius: 12px;
  border: 1px solid rgba(148,163,184,.28);
  padding: .6rem .8rem;
  outline:none;
  color-scheme: dark; /* Memaksa dark mode pada dropdown */
}
.checkbox-wrap{ display:flex; align-items:center; gap:.6rem }

/* ====== CHAT PANEL ====== */
.chat{
  background: var(--panel);
  border:1px solid rgba(148,163,184,.18);
  border-radius: 20px;
  box-shadow: var(--shadow);
  display:flex; flex-direction:column; overflow:hidden;
}

.chat-header{
  display:flex; align-items:center; justify-content:space-between;
  padding: 14px 16px;
  border-bottom: 1px solid rgba(148,163,184,.12);
}

.pill{
  padding:.28rem .6rem; border-radius:999px; font-size:.76rem;
  color: color-mix(in oklab, var(--primary), white 40%);
  background: color-mix(in oklab, var(--primary), #000 85%);
  border:1px solid rgba(148,163,184,.22);
}

/* Messages */
.messages{
  flex:1; overflow:auto; padding: 16px; scroll-behavior: smooth;
  display:flex; flex-direction:column; gap: 12px;
  scrollbar-width:thin; scrollbar-color: rgba(148,163,184,.25) transparent;
}
.messages::-webkit-scrollbar{ width: 6px }
.messages::-webkit-scrollbar-thumb{ background: rgba(148,163,184,.25); border-radius:20px }

.msg{
  display:flex; gap:10px; align-items:flex-start;
  max-width:min(780px, 92%);
}
.msg.assistant{ align-self:flex-start }
.msg.user{ align-self:flex-end; flex-direction: row-reverse }

.bubble{
  padding: .95rem 1.15rem;
  border-radius: 16px;
  line-height: 1.7;
  font-size: clamp(.95rem, .3vw + .84rem, 1.03rem);
  border:1px solid rgba(148,163,184,.18);
  box-shadow: 0 8px 26px rgba(5,10,25,.32);
  word-wrap:break-word;
}
.user .bubble{
  color:#fff;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  border-color: transparent;
}
.assistant .bubble{
  color:#e9eef7;
  background: color-mix(in oklab, var(--bg), #ffffff 3%);
}

/* Code block */
.bubble pre{
  background: #0b1226;
  border:1px solid rgba(148,163,184,.25);
  border-radius: 10px;
  padding: .9rem;
  margin-top:.6rem;
  white-space: pre-wrap;
  font-size: .88rem;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
}

/* --- PERBAIKAN UKURAN GAMBAR PADA BUBBLE --- */
.uploaded-image {
  /* Batasan Lebar: Maks 65% atau 520px untuk desktop */
  max-width: min(65%, 520px); 
  
  max-height: 340px; /* Batasi tinggi agar tidak terlalu dominan (320-360px) */
  border-radius: 12px; 
  object-fit: cover; 
  margin-bottom: 8px; 
  cursor: zoom-in; 
  display: block;
}

/* Tambahkan media query untuk batasan mobile */
@media (max-width: 640px) {
  .uploaded-image {
    max-width: 90%; /* Lebar maks 90% untuk mobile */
  }
}

/* Menghapus margin bawah jika hanya ada gambar di bubble */
.bubble > .uploaded-image:only-child {
  margin-bottom: 0;
}
/* -------------------------------------------------- */


/* Composer */
.composer{
  position: sticky; bottom:0;
  padding: 12px 16px calc(16px + var(--safe-bottom));
  background: linear-gradient(180deg, transparent, rgba(8,12,24,.85) 35%);
  border-top: 1px solid rgba(148,163,184,.12);
}
.input{
  display:flex; gap:10px; align-items:flex-end;
  background: rgba(15,23,42,.7);
  border:1px solid rgba(148,163,184,.25);
  border-radius: 14px;
  padding: 10px;
}
.textarea{
  flex:1; background: transparent; color: var(--text);
  border:none; resize:none; max-height:160px; line-height:1.6;
  font-size: 1rem; outline:none;
}
.send{
  min-width: 96px; height: 42px;
  border:none; border-radius: 999px; cursor:pointer;
  color:#0b1020; font-weight:700;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  box-shadow: 0 10px 20px color-mix(in oklab, var(--primary), #000 80%);
  transition: transform .15s ease, opacity .15s ease, box-shadow .15s ease;
}
.send:disabled{ opacity:.6; cursor:not-allowed }
.send:not(:disabled):hover{ transform: translateY(-1px) }

.meta{
  margin-top:6px; display:flex; justify-content:space-between; color:var(--muted); font-size:.8rem;
}

.upload-label {
    cursor: pointer;
    font-size: 1.5rem;
    line-height: 1;
    color: var(--muted);
    transition: color .2s ease;
    padding: 0 4px 5px 4px;
    align-self: flex-end;
}
.upload-label:hover {
    color: var(--primary);
}

.image-preview-container {
    position: relative;
    max-width: 200px;
    margin-bottom: 12px;
    border-radius: 14px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,.3);
    border: 1px solid rgba(148,163,184,.2);
}
.image-preview {
    width: 100%;
    height: auto;
    display: block;
}
.clear-image-btn {
    position: absolute;
    top: 5px; right: 5px;
    background: rgba(15,23,42,.7);
    color: white;
    border: 1px solid rgba(255,255,255,.3);
    border-radius: 50%;
    width: 24px; height: 24px;
    display: grid; place-items: center;
    cursor: pointer;
    font-weight: 700;
    line-height: 1;
    padding: 0;
    opacity: .8;
    transition: opacity .2s ease;
}
.clear-image-btn:hover {
    opacity: 1;
}

/* Typing dots */
.typing{ display:inline-flex; gap:6px }
.dot{ width:6px; height:6px; border-radius:999px; background:#cbd5f5; opacity:.5; animation: bd 1.2s infinite ease-in-out }
.dot:nth-child(2){ animation-delay:.2s } .dot:nth-child(3){ animation-delay:.4s }
@keyframes bd{ 0%,80%,100%{ transform:translateY(0); opacity:.4 } 40%{ transform:translateY(-4px); opacity:1 } }

/* ====== RESPONSIVE OPTIMIZATION ====== */
@media (max-width: 980px){
  .layout{ 
    grid-template-columns: 1fr; 
    gap: var(--gap3); 
    width:100%; 
    padding: var(--gap3);
  }
  
  .sidebar {
    order: -1; 
    padding: 12px;
  }
  
  .chat{ 
    border-radius: 16px 
  }
  .sidebar{ 
    border-radius: 16px 
  }
  .msg{ 
    max-width: 94% 
  }
  
  .avatar-card{
    max-height: 250px; 
    aspect-ratio: 16/9;
  }
  
  .composer {
      padding: var(--gap2) var(--gap3) calc(var(--gap3) + var(--safe-bottom));
  }
  .input {
      padding: 8px;
  }
  .send {
      min-width: 80px; 
      height: 38px;
  }
  .textarea {
      font-size: .95rem;
  }
  .upload-label {
      font-size: 1.3rem;
  }
}

/* Avatar compositor */ 
.avatar-frame{ 
  position: relative; 
  width: 100%; 
  aspect-ratio: 1 / 1; 
  overflow: hidden; 
  border-radius: 18px; 
  background: rgba(255,255,255,.02); 
} 
.avatar-img{ 
  position:absolute; 
  inset:0; 
  width:100%; 
  height:100%; 
  object-fit: cover; 
  object-position: center top; 
  transform: translateZ(0); 
  will-change: opacity, transform; 
  user-select: none; 
} 
.avatar-img.front{ 
  opacity: 0;
  transition: opacity 0.28s cubic-bezier(.22, .61, .36, 1);
} 
.avatar-img.front.show{ 
  opacity: 1 
} 
.avatar-img.back{ 
  opacity: 1 
} 

/* Overlay (wink/blink) */ 
.avatar-overlay{ 
  position:absolute; 
  inset:0; 
  width:100%; 
  height:100%; 
  object-fit: cover; 
  pointer-events: none; 
  transition: opacity .12s ease; 
  opacity: 0; 
} 
.avatar-overlay.show{ 
  opacity: 1 
} 
.avatar-overlay.hide{ 
  opacity: 0 
} 

/* Glow tipis saat bot mengetik */ 
.avatar-speaking{ 
  position:absolute; 
  inset:0; 
  background: radial-gradient(60% 40% at 50% 70%, rgba(255,192,203,.18), transparent 60%); 
  transition: opacity .2s ease; 
  pointer-events: none; 
  mix-blend-mode: screen; 
}

/* ---------------------------------------------------- */
/* --- PATCH: Z-INDEX & SIZING FIX FOR COMPOSITOR --- */
/* ---------------------------------------------------- */
.avatar-card{ 
  position: relative; 
} 
.avatar-glow{ 
  z-index: 0; 
} 
.avatar-canvas{ 
  z-index: 1; 
  width: 100%; 
  height: 100%; 
} 
.avatar-frame{ 
  position: absolute; 
  inset: 0; 
  border-radius: inherit; 
} 
/* layering gambar */ 
.avatar-img{ z-index: 1; } 
.avatar-img.back{ z-index: 1; } 
.avatar-img.front{ z-index: 2; } 
.avatar-overlay{ z-index: 3; } 
.avatar-speaking{ z-index: 4; }